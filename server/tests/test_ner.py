import spacy
from ..app.ner import calculate_reliability_score

def generate_keywords_from_text(text: str) -> str:
    nlp = spacy.load("en_core_web_sm")
    doc = nlp(text)
    keywords = ", ".join(set([ent.text for ent in doc.ents]))
    return keywords

def test_generate_keywords():
    suits_corpus = """After impressing a slick lawyer with his razor-sharp mind, a college dropout scores a coveted associate job, even though he has no legal credentials. It's mock trial time at Pearson Hardman as Mike faces off against Louis's protégé, Kyle. When Harvey's promotion requires him to recruit and hire a graduate of Harvard Law, he chooses Mike Ross. But Mike doesn't actually have a law degree. An open-and-shut case becomes anything but when Harvey is accused of an inappropriate dalliance with a married woman. Jessica hopes Harvey's promotion will rein him in, but when a crisis arises, Harvey goes rogue trying to fix it. Harvey and Jessica's relationship is tested when Harvey defends someone from her past. Mike's life becomes complicated when an old friend reappears and needs his help. Harvey and Mike work to save a woman wrongly accused of insider trading. Mike is tasked with reining in a modern-day Robin Hood whose illicit deeds are putting a client's business at risk. An undefeated lawyer's shady tactics keep him one step ahead of Harvey, who must decide if he's willing to compromise his ethics to win the case. Harvey must keep Mike out of Jessica's line of fire when his empathy for a fired executive begins to jeopardize the firm's relationship with a client. Harvey's former mentor turns to him for help when his office comes under investigation. Harvey's efforts to free an innocent man hit a wall when he goes against the new district attorney. Oblivious to the fact that Trevor approached Jessica, Mike's on top of the world after Harvey entrusts him with closing a major lawsuit for the firm. As Hardman makes it clear he's back to stay, Jessica tasks Harvey with helping shore up support for her within the firm. Harvey bristles at Daniel's involvement with a lawsuit he's handling, but their battle to one up each other threatens the case. Louis and Mike finally see eye to eye, but Louis's paranoia may damage his budding friendship with Mike as well as his standing at the firm. Harvey balks when Jessica puts him in the passenger seat on a lawsuit that could make or break the firm. Harvey's personal history with a client forces him and Mike to take on an unorthodox case they'd normally walk away from. As the fallout continues to reverberate from the pending lawsuit against Pearson Hardman, Harvey turns to a former colleague. With the continuing upheaval at the firm, Mike and Harvey reflect on how their past decisions have influenced their present situation. Harvey is tasked with closing the one person whose vote will decide Pearson Hardman's future. Harvey needs Mike's help as the battle for control of Pearson Hardman reaches its climax. Harvey and Mike take on a criminal suit that hits close to home for Mike. The war with Daniel may be over, but the battle has left Pearson Hardman vulnerable, and Harvey must protect the firm from a rival. Harvey goes head-to-head against Robert Zane, Rachel's father, on a gender discrimination case. With the resources of the firm stretched to the limit, Daniel Hardman returns with an outrageous lawsuit against Jessica. Dana "Scottie" Scott returns to complicate Harvey and Jessica's battle against Hardman. Harvey's vision for the firm's future clashes with Jessica's when a British firm makes a tempting proposition. In the wake of her new partnership, Jessica is irked by Darby's handling of a case, Mike reconciles with Rachel, and Nigel and Louis vie for position. Harvey must rethink his strategy in Ava's case when the special prosecutor, a disgraced former DA and Harvey's one-time mentor, enters the scene. While Harvey and Louis defend Ava Hessington in business and personal matters, Katrina shakes things up in her attempt to work alongside them. Mike and Katrina try to stop the Giannopoulos Holdings takeover, and Ava finally confesses to bribery that effectively makes her innocent of murder. An attempt to force a witness's hand in Ava's trial backfires, and Mike learns that Rachel has applied to Stanford, meaning she can't join the firm. Flashbacks show Harvey resigning from the DA's office and Mike's acceptance to Harvard, which play out through present-day consequences. Ava's case grows more complicated, a secret causes Donna to break things off with Stephen, and Louis sues for custody of Nigel's cat in a mock trial. Jessica makes amends with Harvey to help get Ava acquitted when multiple strategies seem to fail, and Louis's feud with Harold escalates. With the dissolution of the Pearson Darby Specter firm underway, Louis has a plan to raise revenue. Mike wants to take the next step with Rachel. Harvey deals with Ava's malpractice suit, Jessica learns of Mike and Rachel's relationship, and Louis discovers one of Mike's many secrets. Complications crop up after Harvey lands Scottie a spot with the firm. Elsewhere, Mike faces painful memories in a case against a longtime enemy. After her former husband passes away, Jessica is named co-executor of his will and soon finds herself at odds with his widow. Harvey gets an opportunity to face to a longtime rival he's yet to defeat in court. Meanwhile, Scottie infringes on a case belonging to Louis. While in court, Louis suffers a sudden heart attack. Later, Rachel prevails upon Jessica to fulfill a promise that Louis made. On the eve of going public, one of Pearson Specter's clients faces a bogus lawsuit. Meanwhile, Mike mulls over Jonathan's job offer. After learning about the Hessington settlement, dogged U.S. Attorney Eric Woodall hauls Mike in for a grilling. But Woodall's real target is Harvey. As they adjust to their new paradigm, Mike approaches Harvey with a plan that puts him in a bind. Meanwhile, Jessica faces a difficult choice. Harvey and Mike land on opposite sides of a bitter takeover battle; Louis finds an unlikely partner in recent SEC defector Jeff Malone. Pearson Specter's client, Logan Sanders, pushes Harvey to prove that his relationship with Mike won't interfere with winning their takeover battle. Events take a personal turn when Mike begins a hostile takeover of Gillis Industries, while Harvey and Louis pull out all the stops to win the fight. Mike makes a business move that goes wrong; things get uncomfortably close between Rachel and Logan; Louis helps Donna brush up her Shakespeare. Harvey tries to stop the Gillis Industries takeover, but when Mike keeps playing hardball, Louis sees an opportunity to make a name for himself. When Rachel delivers troubling news, Mike makes a rash decision, leaving Harvey as the last friend he can turn to. Mike returns to Pearson Specter as the firm comes under fire and goes back to working with Rachel in the wake of her confession about Logan. The SEC investigation stirs up anxiety as Sean Cahill takes depositions and the inquisition unearths secrets both professional and personal. Harvey and Jessica try to protect the firm from an outsider attempting to poach their clients; Louis struggles to get his affairs in order. After being re-hired by Jessica, Louis starts persecuting Mike and Rachel hoping to get them to quit. Harvey is approached by an ethics specialist as part of a corrupt business. Meanwhile Louis is busy with his first client as a named partner. Harvey makes Louis and Mike face their trust issues, while a flashback reveals the origins of the rivalry between Harvey and Louis. Harvey tries to temper Mike while Mike has agreed to handle a humanitarian file that could jeopardize the office’s business. While Harvey and Mike are working hard to save the Liberty Rail case, Jessica and Malone try to adjust to their new roles. Harvey revisits his past in the hope of finding a means to put Eric Woodall and Charles Forstman away once and for all. Harvey tries to keep focus amid changes and Donna tries to adjust to working for Louis. Meanwhile, Mike and Rachel prepare to share their big news. Harvey looks for a replacement for Donna, Rachel's father talks to Mike about the engagement, and Louis gets caught up in a salary dispute. Harvey uses Charles Barkley to help steal one of Jack's clients. Meanwhile, Mike loses control of a case when he asks Robert Zane for help. Harvey agrees to take Louis's sister Esther as a client and ends up falling in love. Meanwhile, Mike and Zane conflict over a class-action case. Harvey's old foe Travis Tanner claims he's changed, but the truth will be revealed when the two square off in court in an intellectual property case. A tough case forces Harvey to confront Dr. Agard on the stand. Meanwhile, Mike and Louis deal with Harvey's oldest client. Harvey tells his therapist about his mother. Jessica orders a reluctant Mike to work with Jack. Louis learns the truth about Harvey and Esther. The firm ponders Harvey's punishment for his misdeed. Meanwhile, Mike tries to dodge his first client as a reluctant junior partner. Harvey and Mike discover how low Daniel Hardman will go as they try to stop his hostile takeovers of PSL clients in the wake of Jessica's rejection. Flashbacks reveal episodes from Harvey and Mike's pasts, and Hardman tries to strong-arm the board into ousting Jessica as managing partner. Mike gets an unexpected visitor and encounters a scary but familiar cellmate. Jack Soloff is backed into a corner. Harvey comes home to a surprise. Jim Paulsen is used as leverage. Harvey and Jessica are in Anita Gibbs's cross hairs. Mike begs professor Gerard for help. The tipster is identified. Searching for leverage in her crusade against the firm, Gibbs forces Rachel to choose between testifying against Mike and betraying Jessica. Mike's trial begins with a bang when Gibbs calls a damaging witness to the stand. Meanwhile, Harvey and Mike duke it out over who will take lead. Mike works on another case as he awaits word on his own fate, while Louis and Harvey each consider taking drastic action before the verdict comes in. As Mike's immediate future begins to come into focus, he's forced to deal with the personal and professional consequences of the decisions he's made. Mike faces his new reality as the rest of the PSL partners scramble to save the firm amid internal disagreements and outside litigation. The firm continues to fight the class-action lawsuit. Mike reluctantly makes a new friend. Harvey and Rachel each make visits to see Mike. Mike tries to stay safe in Danbury. Jessica and Harvey work on landing a lucrative client. Louis finds a new office tenant. Mike considers taking a deal that could get him released early. The new office tenants bother Louis and Jessica. Rachel represents a death row inmate. Rachel and Jessica spar over the death row case Rachel wants to take. Mike tries to get Kevin to open up. Harvey coordinates a risky plan. Mike's counselor, Julius, tries to get him to face his past. Harvey and Cahill go head-to-head in the courtroom. Louis comes clean to Tara. Rachel realizes time is running out in the Bailey case. Harvey scrambles to find a rat among Sutter's employees. Mike continues to work on Kevin. Jessica and Rachel make a desperate move in the Bailey case. Louis and Tara reach a crossroads. Harvey and Mike focus on a deal with Jill and Kevin. Cahill takes action against Jill, causing Mike to scramble yet again. Harvey and Mike face tough and potentially dangerous choices in the Gallo case. The outcome of the Sutter case places the firm's other work at risk. Louis gets stunning news. Mike, Harvey and Jessica ponder their next moves. Mike makes a decision about his future, but the realities may be hard to live with. Meanwhile, Louis challenges Zane, and Donna dishes up advice. As Harvey considers his familial obligations, Mike receives long overdue good news. Meanwhile, the battle over managing partner comes to a head. Rachel makes plans for her future, Harvey is given a surprising ultimatum, Donna receives a business proposal, and Mike finds himself in a tough spot. Louis fights to keep a client, a discovery changes how Harvey handles the Velocity case, and Donna experiments with her namesake. When a deal goes south, Mike feels like a man without a country. Meanwhile, Donna pitches investors, and Louis learns that the truth can be costly. Mike's big hearing finally arrives, Tara and Louis struggle to make sense of their relationship, and Donna's side business hits a snag. Mike kicks off his return to Pearson Specter Litt working a sketchy case with Harvey. Donna makes a play for power. Louis faces a downward spiral. Harvey fights to consolidate control of the firm. Mike's criminal history jeopardizes a client's case. Louis does some soul-searching. Louis and Harvey lock horns over the firm's new partner. Rachel struggles to lead the associates. Mike seeks the truth about a man who died in prison. Harvey, Louis and Donna must pull together when another firm comes after them for poaching an attorney. Rachel nudges Mike to make wedding plans. Harvey trusts Louis with a delicate mission. Mike breaks one promise to keep another. Rachel confronts Mike about keeping a secret from her. Rachel confronts Mike about his secret after she takes a risk to protect him, and Harvey's involvement with Paula causes problems. Having lost Harvey's trust, Mike puts his career on the line to drive the prison case forward. Louis's therapist pushes him to take a risk. Rachel puts her family at risk to help Mike and Harvey in the prison case. Donna takes a stand with an old flame. Louis faces a disappointment. Mike proposes a power move to boost business, but Harvey’s past complicates things. Rachel's father offers a surprise chance to join forces. Donna and Harvey reach a crossroads in their relationship, Rachel faces concerns about her father's judgment, and Louis lends Alex a hand. Donna and Harvey face fallout from her impulsive decision. Louis plays hardball to help Jessica. Mike makes a gutsy move with a major new client. While Harvey faces a dilemma over saving his father's legacy, Mike rolls the dice to help a friend and Louis confronts a painful event from his past. Mike and Harvey play hardball to prevent factory jobs from being shipped overseas. Paula pressures Harvey to choose between loyalty and love. Mike and Harvey take the case of a wrongfully accused judge. Louis goes to war with Sheila's fiancé. Donna spars with the firm's duplicitous landlord. Mike takes charge on an emotional class action suit that could make or break the clinic. Harvey scrambles to fend off a surprise threat to the firm. While Harvey helps Jessica in Chicago, Louis defends Specter Litt in New York. Mike and Rachel fight for the clinic -- and make a surprise decision. Harvey and Robert wrangle over control of the firm via a proxy war between Alex and Samantha. Katrina locks horns with Louis over firing an associate. Harvey and Samantha butt heads while scrambling to bail out one of Mike's former clients. Louis struggles with performance anxiety. Harvey clashes with the partners as a feud spins out of control. Katrina faces a setback. Alex makes an alarming discovery about a client. While Louis struggles to cope with a trauma, Robert starts micromanaging the firm and Alex finds himself maneuvered into a no-win situation. A virility test throws Louis for a loop. Samantha blunders while watching Alex's daughter. A custody battle opens old family wounds for Harvey. After they squabble, Louis talks Harvey into seeing Dr. Lipschitz for help tending their relationship. Donna grows suspicious of Samantha. Alex works to help Robert save his countryside winery. Samantha assists Harvey with a shady case. Louis and Sheila spar over religious convictions. Trying to impress, Samantha picks a fight with a heavy hitter. Louis contends with an old high school bully. A blunder puts Gretchen on the line. The long-simmering rivalry between Alex and Samantha boils over as they prepare to go toe-to-toe in court with feuding clients. Alex and Samantha go to war in and out of court to become the firm's next name partner, but their feud threatens to rip Zane Specter Litt apart. Louis dives into his new role but quickly finds himself spread too thin. Harvey and Robert defend a boxing promoter accused of fixing a fight. Louis and Harvey go toe-to-toe at a charity poker event to land a big new client. Pheromones factor in when Katrina and Brian take on a perfume company. Harvey twists arms to thwart a blackmailer. Samantha fights to defend her foster mother. Katrina and Brian clash over their future at the firm. A grieving husband stirs Alex's conscience. Louis goes to bat for his therapist. Shady dealings set Samantha and Scottie on a collision course. Donna’s romance creates trouble for Harvey and Alex. A fight for justice leaves Louis exposed and pushes Samantha to extremes. Brian makes a stand. A breach of trust and a lawsuit against the firm put Harvey's professional life on the line. A trauma sends Samantha and Robert on a hunt for justice."""
    print("testing reliability score...")
    candidate_text = "Goblins are mercilessly vanquished by the prisoner hunters who are loving it, overseen by their Hunters Association escort, Kang Taeshik. After the battle, Song comments on how Jinwoo has really gotten stronger, and how he has a nice new dagger now. Joohee notes Jinwoo's rare lack of injuries and hopes she they won't need her heals, but he reassures her, saying he still counts on her. Song, sensing a deep change in Jinwoo, notes the transformation goes beyond physical, visible in his unique aura. Joohee questions whether he's started practicing martial arts, but he conceals the true extent of his abilities, saying its because of daily exercises. Kang, growing impatient, urges the group to proceed."
    title_keywords = generate_keywords_from_text(suits_corpus)
    print("Score:", calculate_reliability_score(candidate_text, title_keywords))

def main():
    test_generate_keywords()

if __name__ == "__main__":
    main()